
华三、元核云、XSKY

以17.2.0为基础

client和mds的消息



struct MetaRequest
{
  ceph_mds_request_head head;
  filepath path, path2;
}

class MClientRequest   的祖先class Message中有ceph::buffer::list       payload;
{
  decode_payload
  encode_payload
}

struct ceph_mds_request_head head;

Client::make_request
Client::send_request
   Client::build_client_request
      session->con->send_message2   //传入的是MClientRequest，并且已经encode好了payload
	    AsyncConnection::send_message(Message *m)
		   ProtocolV2::send_message
		      ProtocolV2::prepare_send_message  //根据payload准备header和footer


ProtocolV2::write_event             这部分比较模糊
ProtocolV2::write_message




下盘的数据结构见：cinode.h和cinode.cc
                  CInode::encode_store
				  InodeStoreBase::encode_bare

struct inode_t {        //mdstypes.h
  inodeno_t ino = 0;
  uint32_t   rdev = 0;
  utime_t    ctime;
  utime_t    btime;
  uint32_t   mode = 0;
  uid_t      uid = 0;
  gid_t      gid = 0;
  int32_t    nlink = 0;
  ceph_dir_layout dir_layout = {};
  file_layout_t layout;
  compact_set<int64_t, std::less<int64_t>, Allocator<int64_t>> old_pools;
  ...
}


CDentry.h和CDentry.cc

CDentry::encode_remote
CDentry::decode_remote
CDentry::dump


CDir.h和CDir.cc

CDir::commit
CDir::_omap_commit_ops




rename和link： 采用两阶段事务


Server::_link_remote
  op = MMDSPeerRequest::OP_LINKPREP;
  mds->send_message_mds


Server::_commit_peer_link
Server::_commit_peer_rmdir
Server::_commit_peer_rename
Server::_committed_peer

hardlink:
struct inode_backtrace_t

Jerasure2.0: ceph中默认的EC编码就是这个。



王豪迈 (Ceph)
王豪迈,就职于,现任Ceph一职。

豪迈是 XSKY 的 CTO，XSKY 总部在北京。他从 2013 到现在一直在做 Ceph 的全职工作。豪迈在 Kraken 版本的大部分工作是在 AsyncMessenger 上，并将其扩展到多个后端，包括 DPDK 和 InfiniBand 支持。
Ceph中国社区联合创始人耿航

 1 位技术委员会成员(谢型果)、3 位核心贡献者(谢型果、任焕文、严军)
 
 

Ceph的创始人Sage Weil
圆桌会议（Panel Discussion）
峰会(Summit)




在新的元数据服务器上新增的目录树信息要被记录到日志中来持久化，在权限认证信息从旧的服务器转移到新的机器过程中，采用类似2PC的做法，先在两台服务器上写上日志，然后再提交转移，来防止可能的失败。

把inode的内容分为三个组，安全（owner，mode），文件（size，mtime），不可变的（inode number，ctime，layout），不可变的字段是只读的，安全和文件这两组都拥有自己的锁和状态机。


